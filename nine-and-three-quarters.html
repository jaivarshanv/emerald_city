<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emerald City: Spellbound | IEEE-CS VIT</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=IM+Fell+DW+Pica+SC&family=Pirata+One&display=swap');
        
        * { cursor: none !important; }
        body { 
            background-color: #010103; 
            margin: 0; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            min-height: 100vh; 
            font-family: 'IM Fell DW Pica SC', serif; 
            overflow: hidden; 
            transition: background-color 2s;
        }
        
        canvas#storm-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; pointer-events: none; }

        /* HEADER - UNIFIED FONT */
        #game-header {
            position: fixed; top: 30px; width: 100%;
            font-family: 'IM Fell DW Pica SC', serif; font-size: 4rem; color: #d4af37;
            text-shadow: 0 0 10px rgba(212, 175, 55, 0.5), 3px 3px 5px #000;
            z-index: 100; display: none; text-align: center;
            letter-spacing: 6px; text-transform: uppercase;
        }

        /* STARTING SCREEN */
        #intro-overlay { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: #000; z-index: 2000; display: flex; 
            flex-direction: column; justify-content: center; align-items: center; 
        }
        #listen-text { 
            color: #d4af37; font-family: 'IM Fell DW Pica SC'; font-size: 3rem; 
            text-align: center; animation: pulse 2.5s infinite; letter-spacing: 4px;
        }
        @keyframes pulse { 0% { opacity: 0.3; } 50% { opacity: 1; } 100% { opacity: 0.3; } }

        /* ELDER WAND */
        #wand-anchor { position: fixed; top: 0; left: 0; pointer-events: none; z-index: 1000; transform-origin: 300px 6px; display: flex; align-items: center; }
        .wand-body { height: 12px; width: 300px; background: linear-gradient(90deg, #1a0f08, #3d2b1f, #2a1b0e); border-radius: 6px; position: relative; }
        .elder-node { position: absolute; height: 24px; width: 24px; background: radial-gradient(circle at 30% 30%, #4d3626, #1a0f08); border-radius: 50%; top: -6px; }
        .n1 { right: 30px; } .n2 { right: 90px; } .n3 { right: 150px; } .n4 { right: 210px; } .n5 { right: 270px; }
        .wand-tip { position: absolute; right: -5px; top: -1px; width: 14px; height: 14px; background: #fff; border-radius: 50%; box-shadow: 0 0 25px 10px #d4af37, 0 0 50px 20px #fff; }

        /* ENVELOPE */
        #envelope-wrapper { display: none; z-index: 10; cursor: pointer !important; opacity: 0; transition: opacity 1.5s; }
        .envelope { width: 550px; height: 350px; background: #e4d5b7; position: relative; display: flex; justify-content: center; align-items: flex-end; padding-bottom: 40px; box-shadow: 0 40px 120px #000; }
        .flap { position: absolute; top: 0; width: 0; height: 0; border-left: 275px solid transparent; border-right: 275px solid transparent; border-top: 200px solid #d4c3a1; }
        .wax-seal { position: absolute; top: 45%; left: 50%; transform: translate(-50%, -50%); width: 110px; height: 110px; background: #8b0000; border-radius: 50%; border: 4px solid #3a0000; color: #d4af37; display: flex; align-items: center; justify-content: center; font-family: 'Pirata One'; font-size: 1.6rem; }

        /* QUIZ BOX (UPSIZED) */
        #main-container { display: none; width: 85%; max-width: 900px; background: #f4e4bc url('https://www.transparenttextures.com/patterns/paper-fibers.png'); padding: 60px; border: 4px solid #d4af37; box-shadow: 0 0 150px rgba(0,0,0,1); text-align: center; z-index: 20; position: relative; margin-top: 100px; transition: opacity 2s; }
        #hat-bubble { background: white; padding: 25px; border: 3px solid #3b2a1a; border-radius: 15px; font-weight: bold; color: #5d0000; margin-bottom: 35px; font-size: 1.6rem; }
        #q-text { font-size: 2rem; line-height: 1.5; margin-bottom: 40px; color: #1a0f08; }
        .btn { background: #2a1b0e; color: #f4e4bc; padding: 25px; border: 2px solid #d4af37; font-family: 'IM Fell DW Pica SC'; width: 100%; margin-top: 15px; font-size: 1.6rem; transition: 0.3s; pointer-events: auto; }
        .btn:hover { background: #5d0000; box-shadow: 0 0 25px #d4af37; transform: scale(1.02); }
        .hidden { display: none; }

        /* FINAL EFFECTS */
        .fade-mischief { opacity: 0 !important; pointer-events: none; }
        .dark-bg { background-color: #000 !important; }
    </style>
</head>
<body onclick="startExperience()">

<div id="intro-overlay">
    <div id="listen-text">LISTEN CLOSELY... THE TRIAL BEGINS</div>
    <p style="color: #666; margin-top: 20px; letter-spacing: 2px;">(CLICK ANYWHERE TO UNLOCK THE MAGIC)</p>
</div>

<h1 id="game-header">EMERALD CITY : SPELL BOUND</h1>

<canvas id="storm-canvas"></canvas>

<audio id="bg-music" loop src="hpt.mp3"></audio>
<audio id="opening-voice" src="opening.mp3"></audio>
<audio id="hat-voice"></audio>
<audio id="thunder-sound" src="thunder.mp3"></audio>

<div id="wand-anchor">
    <div class="wand-body">
        <div class="elder-node n1"></div><div class="elder-node n2"></div>
        <div class="elder-node n3"></div><div class="elder-node n4"></div>
        <div class="elder-node n5"></div>
        <div class="wand-tip"></div>
    </div>
</div>

<div id="envelope-wrapper" onclick="openLetter()">
    <div class="envelope">
        <div class="flap"></div>
        <div class="wax-seal">IEEE-CS</div>
        <p style="color: #5d4a37; font-weight: bold; font-size: 1.4rem; letter-spacing: 2px;">OPEN THE SEAL</p>
    </div>
</div>

<div id="main-container">
    <div id="hat-bubble">"Prove you are a wizard of VIT, or be gone."</div>
    <div id="quiz-ui">
        <p id="q-text"></p>
        <div id="options"></div>
    </div>
    <div id="result-ui" class="hidden">
        <h1 style="color: #006400; font-size: 3.5rem; letter-spacing: 4px;">MISCHIEF MANAGED!</h1>
        <p style="font-size: 1.8rem;">The Portkey is ready. Redirecting...</p>
    </div>
</div>

<script>
    const questions = [
        { q: "A vast amphitheater where the voices resound... Named for the great leader who mastered the art of the word... Under the crimson canopy, the legends are told.", ans: "Anna Auditorium", audio: "annaaudi.mp3", distractors: ["Amphi Theatre", "Chanakya Hall"] },
        { q: "A silent cathedral of parchment and ink... Guarded by turnstiles that demand a digital key... Do you seek the ancient lore or the modern theory?", ans: "Central Library", audio: "library.mp3", distractors: ["CDMM", "SJT"] },
        { q: "The final boundary where the sentinels stand, between our sanctuary and the Muggle land... The clock strikes the hour of curfew... Do you have the Seal to pass through?", ans: "Main Gate", audio: "maingate.mp3", distractors: ["SJT Back Gate", "Katpadi Tracks"] },
        { q: "Beneath the hall where champions sweat... lies a subterranean vault hidden from the light. A bustling marketplace for the hungry and the bold.", ans: "All-Mart", audio: "ALLmart.mp3", distractors: ["Foodys", "Nescafe"] }
    ];

    const sharpMocks = [
        { text: "Wrong. A Muggle could have guessed better.", file: "brains.mp3" },
        { text: "Incorrect. Perhaps I should have sorted you into the 'Lost and Found'.", file: "lost and found.mp3" },
        { text: "Pathetic. Try again, or find someone more worthy.", file: "more worthy.mp3" },
        { text: "You're clearly out of your league.", file: "out of your league.mp3" }
    ];

    let currentStep = 0;
    let magicStarted = false;
    const bgMusic = document.getElementById('bg-music');
    const openingVoice = document.getElementById('opening-voice');
    const hatVoice = document.getElementById('hat-voice');
    const thunder = document.getElementById('thunder-sound');

    function startExperience() {
        if (magicStarted) return;
        magicStarted = true;
        
        bgMusic.volume = 0.25;
        bgMusic.play();
        openingVoice.play();

        openingVoice.onended = () => {
            document.getElementById('intro-overlay').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('intro-overlay').style.display = 'none';
                document.getElementById('game-header').style.display = 'block';
                document.getElementById('envelope-wrapper').style.display = 'block';
                setTimeout(() => { document.getElementById('envelope-wrapper').style.opacity = '1'; }, 50);
            }, 1000);
        };
    }

    function openLetter() {
        document.getElementById('envelope-wrapper').style.display = 'none';
        document.getElementById('main-container').style.display = 'block';
        showQuestion();
    }

    function showQuestion() {
        const qData = questions[currentStep];
        document.getElementById('q-text').innerText = qData.q;
        hatVoice.src = qData.audio;
        hatVoice.play();
        
        const optDiv = document.getElementById('options');
        optDiv.innerHTML = '';
        let choices = [qData.ans, ...qData.distractors].sort(() => Math.random() - 0.5);
        
        choices.forEach(choice => {
            const b = document.createElement('button');
            b.className = 'btn'; b.innerText = choice;
            b.onclick = () => {
                // STOP THE VOICE IMMEDIATELY ON CLICK
                hatVoice.pause();
                hatVoice.currentTime = 0;

                if(choice === qData.ans) {
                    currentStep++;
                    if(currentStep < questions.length) {
                        document.getElementById('hat-bubble').innerText = '"Correct. Prepare for the next trial."';
                        optDiv.innerHTML = ''; 
                        setTimeout(showQuestion, 2000); // 2-second gap before next riddle
                    } else {
                        // FINAL VICTORY & FADE
                        document.getElementById('quiz-ui').classList.add('hidden');
                        document.getElementById('result-ui').classList.remove('hidden');
                        
                        setTimeout(() => {
                            document.body.classList.add('dark-bg');
                            document.getElementById('main-container').classList.add('fade-mischief');
                            document.getElementById('game-header').classList.add('fade-mischief');
                        }, 2000);

                        setTimeout(() => { 
                            window.location.href = "https://riviera.vit.ac.in/events/evt_f5838cb6d4de4e469b55ef9910deb062"; 
                        }, 5000);
                    }
                } else {
                    const mock = sharpMocks[Math.floor(Math.random() * sharpMocks.length)];
                    document.getElementById('hat-bubble').innerText = `"${mock.text}"`;
                    hatVoice.src = mock.file;
                    hatVoice.play();
                }
            };
            optDiv.appendChild(b);
        });
    }

    // STORM ENGINE
    const canvas = document.getElementById('storm-canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth; canvas.height = window.innerHeight;
    let raindrops = [];
    for(let i = 0; i < 250; i++) { raindrops.push({ x: Math.random()*canvas.width, y: Math.random()*canvas.height, l: Math.random()*25, v: Math.random()*15+15 }); }

    function drawStorm() {
        ctx.fillStyle = 'rgba(0,0,0,0.2)'; ctx.fillRect(0,0,canvas.width,canvas.height);
        ctx.strokeStyle = 'rgba(174,194,224,0.4)'; ctx.lineWidth = 1;
        raindrops.forEach(r => {
            ctx.beginPath(); ctx.moveTo(r.x, r.y); ctx.lineTo(r.x, r.y+r.l); ctx.stroke();
            r.y += r.v; if(r.y > canvas.height) r.y = -20;
        });

        if(Math.random() > 0.96) {
            ctx.fillStyle = 'rgba(255,255,255,0.4)'; ctx.fillRect(0,0,canvas.width,canvas.height);
            ctx.strokeStyle = '#fff'; ctx.lineWidth = 4;
            let startX = Math.random()*canvas.width;
            ctx.beginPath(); ctx.moveTo(startX, 0); ctx.lineTo(startX + (Math.random()-0.5)*200, canvas.height/2);
            ctx.lineTo(startX + (Math.random()-0.5)*400, canvas.height); ctx.stroke();
            if(magicStarted) { thunder.volume = 0.4; thunder.currentTime = 0; thunder.play(); }
        }
        requestAnimationFrame(drawStorm);
    }
    drawStorm();

    const wand = document.getElementById('wand-anchor');
    document.addEventListener('mousemove', (e) => {
        wand.style.left = (e.clientX - 300) + 'px';
        wand.style.top = (e.clientY - 6) + 'px';
        const angle = Math.atan2(e.clientY - window.innerHeight / 2, e.clientX - window.innerWidth / 2);
        wand.style.transform = `rotate(${angle}rad)`;
    });
</script>
</body>
</html>